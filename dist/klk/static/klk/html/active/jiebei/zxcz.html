<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>客拉客 - 借呗</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <!--<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=off">-->
  <meta name="renderer" content="webkit">
  <meta name="_token" content="">
  <meta name="format-detection" content="telephone=no">
  <meta http-equiv="x-rim-auto-match" content="none">
  <link rel="shortcut icon" href="/newindex/favicon.ico">
  <link type="text/css" rel="stylesheet" href="css/init.css"/>
  <link type="text/css" rel="stylesheet" href="css/jiebei.css"/>

  <script type="text/javascript" rel="script" src="lib/polyfill.min.js?v=1.0.0"></script>
</head>
<body style="padding-bottom: 56px;">

<!--头部-->
<header class="header">

  <!--顶部-->
  <div class="header-top clear-fix">
    <div class="header-content clear-fix">

      <!--logo区域-->
      <a class="float-left img-link" href="/" target="_blank">
        <img style="margin-top: 24px" src="img/logo.png?v=1.0.0" alt="客拉客"/>
      </a>
      <a class="float-left img-link" href="javascript: void(0)">
        <img style="margin-top: 34px" src="img/header-span.png?v=1.0.0" alt=""/>
      </a>
      <a class="float-left img-link" href="index.html">
        <img style="margin-top: 47px" src="img/header-text-dot.png?v=1.0.0" alt="借呗"/>
      </a>
      <a class="float-left img-link" href="javascript: void(0)">
        <img style="margin-top: 47px" src="img/header-text-zxcz.png?v=1.0.0" alt=""/>
      </a>

    </div>
  </div>
</header>

<!--主题内容-->
<div class="main">
  <div class="main-body">
    <ol class="main-tab">
      <li class="main-tab-item" nav="网银转账">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/yl.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/yl.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="网银转账">网银转账</span>
      </li>
      <li class="main-tab-item" nav="微信转账">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/wx.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/wx.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="微信转账">微信转账</span>
      </li>
      <li class="main-tab-item" nav="支付宝转账">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/zfb.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/zfb.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="支付宝转账">支付宝转账</span>
      </li>
      <li class="main-tab-item" nav="网银在线">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/wy.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/wy.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="网银在线">网银在线</span>
      </li>
      <li class="main-tab-item" nav="支付宝在线">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/zfb.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/zfb.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="支付宝在线">支付宝在线</span>
      </li>
      <li class="main-tab-item" nav="微信在线">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/wx.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/wx.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="微信在线">微信在线</span>
      </li>
      <li class="main-tab-item" nav="QQ在线">
        <img class="main-tab-item-icon false" src="img/zf-icon/zf-icon-false/qq.png?v=1.0.0" alt=""/>
        <img class="main-tab-item-icon true" src="img/zf-icon/zf-icon-true/qq.png?v=1.0.0" alt=""/>
        <span class="main-tab-item-name" action="QQ在线">QQ在线</span>
      </li>
    </ol>


    <div class="main-tab-content" id="main-tab-content" style="display: none;">
      <div class="main-tab-content-box" id="网银转账">
        <form method="post" action="api/return_amount/bank/">
          <div class="content-body step-1" id="step-1">
            <div class="clear-fix" id="banks"></div>
            <a class="action-bottom" href="javascript: void(0)" id="next">下一步</a>
          </div>
          <div class="content-body step-2 form" id="step-2">
            <h4 class="title">请认真填写一下汇款单</h4>
            <label class="form-row">
              <span class="form-label">用户账户:</span>
              <input type="text" class="form-input" name="username" value="" disabled/>
            </label>
            <label class="form-row">
              <span class="form-label">汇款日期:</span>
              <input type="date" class="form-input" value="" name="date"/>
            </label>
            <label class="form-row">
              <span class="form-label">汇款方式:</span>
              <select class="form-input" name="type">
                <option value="">请选择汇款方式</option>
                <option value="手机转账">手机转账</option>
                <option value="支付宝转账">支付宝转账</option>
                <option value="微信转账">微信转账</option>
                <option value="网银转账">网银转账</option>
                <option value="柜台转账">柜台转账</option>
                <option value="ATM存款">ATM存款</option>
              </select>
            </label>
            <label class="form-row">
              <span class="form-label">还款金额:</span>
              <input type="number" min="0" class="form-input" value="" name="amount"/>
            </label>
            <label class="form-row">
              <span class="form-label">汇款姓名:</span>
              <input type="text" class="form-input" name="name"/>
            </label>
            <label class="form-row">
              <span class="form-label">汇款地点:</span>
              <input type="text" class="form-input" name="address"/>
            </label>
            <input class="action-bottom" type="submit" value="确认提交">
          </div>
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、转账时，务必增加小数点(如：500.77)，以便财务查款。
          <br/>
          2、转帐后请保留单据作为核对证明。
          <br/>
          3、转账成功后，返回“我要还款”页面提交您的存款信息。
        </p>
      </div>

      <div class="main-tab-content-box" id="微信转账">
        <div class="content-header clear-fix">
          <span class="action-name float-left">微信转账</span>
          <ul class="action-options float-left clear-fix" id="port-box"></ul>
        </div>
        <div class="content-hr"></div>
        <form class="content-body" method="post" target="_blank" action="api/return_amount/qr/">
          <input type="hidden" name="id" value=""/>
          <input type="hidden" name="type" value="weixin"/>
          <input type="hidden" name="username" value=""/>
          <img class="qr-code" id="qr" src="" alt="二维码">
          <span class="info">打开<span style="color: #ff0000;">微信</span>扫一扫</span>
          <label style="display: block;">
            <input class="qr-code-input" type="text" autocomplete="off" name="name" placeholder="支付宝名称"/>
          </label>
          <label style="display: block;">
            <input class="qr-code-input" type="number" min="0" autocomplete="off" name="amount" placeholder="转账金额"/>
          </label>
          <label style="display: block;">
            <input class="qr-code-input" type="text" autocomplete="off" name="order_last_9" placeholder="请输入订单号后九位"/>
          </label>
          <input class="form-submit body-submit" type="submit" value="确认提交">
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、由于银行管制、导致第三方充值通道不稳定、如果充值一次未成功请换其他通道进行充值！
        </p>
      </div>

      <div class="main-tab-content-box" id="支付宝转账">
        <div class="content-header clear-fix">
          <span class="action-name float-left">支付宝转账</span>
          <ul class="action-options float-left clear-fix" id="port-box"></ul>
        </div>
        <div class="content-hr"></div>
        <form class="content-body" method="post" target="_blank" action="api/return_amount/qr/">
          <input type="hidden" name="id" value=""/>
          <input type="hidden" name="type" value="zhifubao"/>
          <input type="hidden" name="username" value=""/>
          <img class="qr-code" id="qr" src="" alt="二维码">
          <span class="info">打开<span style="color: #ff0000;">微信</span>扫一扫</span>
          <label style="display: block;">
            <input class="qr-code-input" type="text" autocomplete="off" name="name" placeholder="支付宝名称"/>
          </label>
          <label style="display: block;">
            <input class="qr-code-input" type="number" min="0" autocomplete="off" name="amount" placeholder="转账金额"/>
          </label>
          <label style="display: block;">
            <input class="qr-code-input" type="text" autocomplete="off" name="order_last_9" placeholder="请输入订单号后九位"/>
          </label>
          <input class="form-submit body-submit" type="submit" value="确认提交">
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、由于银行管制、导致第三方充值通道不稳定、如果充值一次未成功请换其他通道进行充值！
        </p>
      </div>

      <div class="main-tab-content-box" id="网银在线">
        <div class="content-header clear-fix">
          <span class="action-name float-left">网银支付</span>
          <ul class="action-options float-left clear-fix" id="port-box"></ul>
        </div>
        <div class="content-hr"></div>
        <form class="content-body" method="post" target="_blank" action="">
          <input type="hidden" name="id" value=""/>
          <input type="hidden" name="username" value=""/>
          <div class="body-row clear-fix">
            <label class="float-left">
              <span class="body-input-label">存款金额:</span>
              <input class="body-input" type="number" name="amount" min="0" autocomplete="off"/>
            </label>
            <div class="float-left clear-fix">
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="50"/>
                <span class="radio-dot"></span>
                <span>50</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="100"/>
                <span class="radio-dot"></span>
                <span>100</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="500"/>
                <span class="radio-dot"></span>
                <span>500</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="1000"/>
                <span class="radio-dot"></span>
                <span>1000</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="5000"/>
                <span class="radio-dot"></span>
                <span>5000</span>
              </label>
            </div>
          </div>
          <div class="body-row clear-fix">
            <label class="float-left">
              <span class="body-input-label">存款方式:</span>
            </label>
            <div class="float-left clear-fix bank" style="width: 738px" id="banks"></div>
          </div>
          <input class="form-submit body-submit" type="submit" value="确认提交">
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、由于银行管制、导致第三方充值通道不稳定、如果充值一次未成功请换其他通道进行充值！
        </p>
      </div>

      <div class="main-tab-content-box" id="支付宝在线">
        <div class="content-header clear-fix">
          <span class="action-name float-left">支付宝在线</span>
          <ul class="action-options float-left clear-fix" id="port-box"></ul>
        </div>
        <div class="content-hr"></div>
        <form class="content-body" method="post" target="_blank" action="">
          <input type="hidden" name="id" value=""/>
          <input type="hidden" name="username" value=""/>
          <div class="body-row clear-fix">
            <label class="float-left">
              <span class="body-input-label">存款金额:</span>
              <input class="body-input" type="number" name="amount" min="0" autocomplete="off"/>
            </label>
            <div class="float-left clear-fix" style="margin-left: 32px">
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="50"/>
                <span class="radio-dot"></span>
                <span>50</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="100"/>
                <span class="radio-dot"></span>
                <span>100</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="500"/>
                <span class="radio-dot"></span>
                <span>500</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="1000"/>
                <span class="radio-dot"></span>
                <span>1000</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="5000"/>
                <span class="radio-dot"></span>
                <span>5000</span>
              </label>
            </div>
          </div>
          <input class="form-submit body-submit" type="submit" value="确认提交">
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、由于银行管制、导致第三方充值通道不稳定、如果充值一次未成功请换其他通道进行充值！
        </p>
      </div>

      <div class="main-tab-content-box" id="微信在线">
        <div class="content-header clear-fix">
          <span class="action-name float-left">微信在线</span>
          <ul class="action-options float-left clear-fix" id="port-box"></ul>
        </div>
        <div class="content-hr"></div>
        <form class="content-body" method="post" target="_blank" action="">
          <input type="hidden" name="id" value=""/>
          <input type="hidden" name="username" value=""/>
          <div class="body-row clear-fix">
            <label class="float-left">
              <span class="body-input-label">存款金额:</span>
              <input class="body-input" type="number" name="amount" min="0" autocomplete="off"/>
            </label>
            <div class="float-left clear-fix" style="margin-left: 32px">
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="50"/>
                <span class="radio-dot"></span>
                <span>50</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="100"/>
                <span class="radio-dot"></span>
                <span>100</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="500"/>
                <span class="radio-dot"></span>
                <span>500</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="1000"/>
                <span class="radio-dot"></span>
                <span>1000</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="5000"/>
                <span class="radio-dot"></span>
                <span>5000</span>
              </label>
            </div>
          </div>
          <input class="form-submit body-submit" type="submit" value="确认提交">
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、由于银行管制、导致第三方充值通道不稳定、如果充值一次未成功请换其他通道进行充值！
        </p>
      </div>

      <div class="main-tab-content-box" id="QQ在线">
        <div class="content-header clear-fix">
          <span class="action-name float-left">QQ在线</span>
          <ul class="action-options float-left clear-fix" id="port-box"></ul>
        </div>
        <div class="content-hr"></div>
        <form class="content-body" method="post" target="_blank" action="">
          <input type="hidden" name="id" value=""/>
          <input type="hidden" name="username" value=""/>
          <div class="body-row clear-fix">
            <label class="float-left">
              <span class="body-input-label">存款金额:</span>
              <input class="body-input" type="number" name="amount" min="0" autocomplete="off"/>
            </label>
            <div class="float-left clear-fix" style="margin-left: 32px">
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="50"/>
                <span class="radio-dot"></span>
                <span>50</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="100"/>
                <span class="radio-dot"></span>
                <span>100</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="500"/>
                <span class="radio-dot"></span>
                <span>500</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="1000"/>
                <span class="radio-dot"></span>
                <span>1000</span>
              </label>
              <label class="radio radio-default form-radio float-left">
                <input type="radio" name="money-item" value="5000"/>
                <span class="radio-dot"></span>
                <span>5000</span>
              </label>
            </div>
          </div>
          <input class="form-submit body-submit" type="submit" value="确认提交">
        </form>
        <p class="content-prompt">
          温馨提示：
          <br/>
          1、由于银行管制、导致第三方充值通道不稳定、如果充值一次未成功请换其他通道进行充值！
        </p>
      </div>

    </div>
  </div>
</div>

<footer style="position: absolute;bottom: 0; width: 100%;height: 56px;">
  <p class="copyright">Copyright ©客拉客 Reserved</p>
</footer>

<script type="text/javascript" rel="script" src="lib/jquery-1.12.4.min.js?v=1.0.0"></script>
<script type="text/javascript" rel="script" src="lib/clipboard.min.js?v=1.0.0"></script>
<script type="text/javascript" rel="script" src="js/modal.js?v=1.0.0"></script>
<script type="text/javascript" rel="script">
  // (function ($) {
  //   $.getUrlParam = function (name) {
  //     var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)')
  //     var r = window.location.search.substr(1).match(reg)
  //     if (r != null) return unescape(r[2])
  //     return null
  //   }
  // })($)

  var $window = $(window)

  function onScreen () {
    if (window.screen.width < 992) window.open('./m/index.html', '_self')
  }

  onScreen()
  $window.resize(onScreen)
</script>
<script type="text/javascript" rel="script">
  $(function () {
    var USER = {
      username: '',
      queryAmount: ''
    }

    $.getJSON('kf.json?t=' + Math.random(), function (res) {
      var thisHost = window.location.host
      var href = res[thisHost] || res.default
      $('.kf').attr('href', href)
    })

    // 优化表单重置
    var HTMLs = {}
    $('#main-tab-content > .main-tab-content-box').each(function () {
      var that = $(this)
      HTMLs[this.id] = that.prop('outerHTML').replace(/>[\s]*</, '><')
    })

    var tabContent = $('#main-tab-content')
    tabContent.html('')

    //tab状态封装
    var active = {
      type: '', // 当前选中的充值类
      data: [], // 当前类型的充接口数据
      port: 0, // 当前选中的通道port
      setType: function (type) {
        if (this.type !== type) {
          tabContent.html('')
          var that = this
          that.type = type

          /*
           * 判断支付类型,根据支付类型获取不同的支付通道
           */
          switch (type) {
            case '支付宝在线':
              $.post('api/index.php', {
                action: 'onlinePayList',
                clientType: 'pc',
                type: 'zhifubao'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break

            case '微信在线':
              $.post('api/index.php', {
                action: 'onlinePayList',
                clientType: 'pc',
                type: 'weixin'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break

            case 'QQ在线':
              $.post('api/index.php', {
                action: 'onlinePayList',
                clientType: 'pc',
                type: 'qq'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break

            case '微信转账':
              $.post('api/index.php', {
                action: 'qrTransferList',
                type: 'weixin'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break

            case '支付宝转账':
              $.post('api/index.php', {
                action: 'qrTransferList',
                type: 'zhifubao'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break

            case '网银在线':
              $.post('api/index.php', {
                action: 'onlinePayList',
                clientType: 'pc',
                type: 'wangyin'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break

            case '网银转账':
              $.post('api/index.php', {
                action: 'bankTransferList'
              }, function (res) {
                that.data = JSON.parse(res).data
                callback(type)
              })
              break
          }

          var nums = ['①', '②', '③', '④', '⑤', '⑥', '⑦', '⑧', '⑨', '⑩']

          /**
           * 获取支付通道后的回调,根据类型不同做不同的处理
           * @param tag 类型标签,有 转账 在线 网银转账 网银在线
           */
          function callback (type) {
            var $content = $(HTMLs[that.type])
            var $form = $content.find('form')
            $form.hide()

            if (type === '支付宝在线' || type === '微信在线' || type === 'QQ在线') {

              var $portBox = $content.find('#port-box')

              $.each(that.data, function (index) {
                $portBox.append('<li class="float-left" index="' + index + '"><a class="port-button" href="javascript: void(0)">充值通道' + nums[index] + '</a></li>')
              })

              var $ports = $portBox.find('li')
              var $input = $form.find('input[name=amount]')
              var $moneyItems = $form.find('input[type=radio]')

              $ports.on('click', function () {
                $ports.removeClass('active')
                var $this = $(this)
                $this.addClass('active')
                var index = parseInt($this.attr('index'))
                var data = that.data[index]

                $form.attr('action', data['pay_url'])
                $form.attr('index', index)

                $input.val(USER.queryAmount || '')
                $input.attr('min', data['pay_min_amount'])
                $input.attr('max', data['pay_max_amount'])
                $input.attr('placeholder', '单笔限额' + data['pay_min_amount'] + '~' + data['pay_max_amount'])

                $form.find('input[name=username]').val(USER.username)
                $form.find('input[name=id]').val(data['id'])
                $('form').hide()
                $form.show()
              })

              $moneyItems.on('change', function () {
                var $this = $(this)
                $input.val($this.val())
              })

              $input.on('change', function () {
                var val = $(this).val()
                $moneyItems.each(function () {
                  this.checked = val === $(this).val()
                })
              })

              $form.on('submit', function () {
                var $this = $(this)

                var index = parseInt($this.attr('index'))
                var data = that.data[index]
                var money = parseInt($this.find('input[name=amount]').val())
                if (!money) {
                  alert({
                    title: '提示',
                    text: '请输入金额'
                  })
                  return false
                } else if (money < data['pay_min_amount'] || money > data['pay_max_amount']) {
                  alert({
                    title: '提示',
                    text: '金额必须为<span style="color: #ff0000;">' + data['pay_min_amount']
                      + '</span>到<span style="color: #ff0000;">' + data['pay_max_amount'] + '</span>之间'
                  })
                  return false
                } else return true
              })

              $ports.first().click()

            } else if (type === '微信转账' || type === '支付宝转账') {

              var $portBox = $content.find('#port-box')

              $.each(that.data, function (index) {
                $portBox.append('<li class="float-left" index="' + index + '"><a class="port-button" href="javascript: void(0)">充值通道' + nums[index] + '</a></li>')
              })

              var $ports = $portBox.find('li')
              var $qr = $form.find('#qr')
              var $name = $form.find('input[name=name]')
              var $amount = $form.find('input[name=amount]')
              var $order = $form.find('input[name=order_last_9]')

              $ports.on('click', function () {
                $ports.removeClass('active')
                var $this = $(this)
                $this.addClass('active')
                var index = parseInt($this.attr('index'))
                var data = that.data[index]

                $qr.attr('src', data['qrcode_url'])
                $name.val('')
                $order.val('')
                $amount.val(USER.queryAmount || '')
                $amount.attr('min', data['min'])
                $amount.attr('max', data['max'])

                $form.attr('index', index)
                $form.find('input[name=username]').val(USER.username)
                $form.find('input[name=id]').val(data['id'])
                $('form').hide()
                $form.show()
              })

              $form.on('submit', function () {
                var $this = $(this)
                var amount = parseInt($amount.val())

                if (!$name.val()) {
                  alert({ text: '请输入您的支付宝名称' })
                  return false
                } else if (isNaN(amount)) {
                  alert({ text: '请输入转账金额' })
                  return false
                } else if (amount < parseInt(data['min']) || amount > parseInt(data['max'])) {
                  alert({ text: '单笔限额' + data['pay_min_amount'] + '~' + data['pay_max_amount'] })
                  return false
                } else if (!/^[A-z0-9]{9}$/.test($order.val())) {
                  alert({ text: '请输入订单号后9位' })
                  return false
                } else return true
              })

              $ports.first().click()
            } else if (type === '网银在线') {

              var $portBox = $content.find('#port-box')

              $.each(that.data, function (index) {
                $portBox.append('<li class="float-left" index="' + index + '"><a class="port-button" href="javascript: void(0)">充值通道' + nums[index] + '</a></li>')
              })

              var $banks = $form.find('#banks')
              var $ports = $portBox.find('li')
              var $input = $form.find('input[name=amount]')
              var $moneyItems = $form.find('input[type=radio]')

              $ports.on('click', function () {
                $ports.removeClass('active')
                var $this = $(this)
                $this.addClass('active')

                var index = parseInt($this.attr('index'))
                var data = that.data[index]
                data['wangyin_code_json'] = JSON.parse(data['wangyin_code_json'])

                $input.val(USER.queryAmount || '')
                $input.attr('min', data['pay_min_amount'])
                $input.attr('max', data['pay_max_amount'])
                $input.attr('placeholder', '单笔限额' + data['pay_min_amount'] + '~' + data['pay_max_amount'])

                $banks.html('')
                $.each(data['wangyin_code_json'], function () {
                  $banks.append('<label class="radio radio-default form-radio float-left">' +
                    '<input type="radio" name="code" value="' + this.code + '"/>' +
                    '<span class="radio-dot"></span>' +
                    '<img class="radio-img" src="' + this.icon + '" alt="' + this.name + '"/>' +
                    '</label>')
                })

                $form.attr('action', data['pay_url'])
                $form.attr('index', index)
                $form.find('input[name=username]').val(USER.username)
                $form.find('input[name=id]').val(data['id'])
                $('form').hide()
                $form.show()
              })

              $input.on('change', function () {
                var val = $(this).val()
                $moneyItems.each(function () {
                  this.checked = val === $(this).val()
                })
              })

              $moneyItems.on('change', function () {
                var $this = $(this)
                $input.val($this.val())
              })

              $form.on('submit', function () {
                var $this = $(this)
                var index = parseInt($this.attr('index'))
                var data = that.data[index]
                var money = parseInt($this.find('input[name=amount]').val())
                var bankChecked = false
                $banks.find('input[name=code]').each(function () {
                  if (this.checked) {
                    bankChecked = true
                    return false
                  }
                })

                if (!money) {
                  alert({
                    title: '提示',
                    text: '请输入金额'
                  })
                  return false
                } else if (money < data['pay_min_amount'] || money > data['pay_max_amount']) {
                  alert({
                    title: '提示',
                    text: '金额必须为<span style="color: #ff0000;">' + data['pay_min_amount']
                      + '</span>到<span style="color: #ff0000;">' + data['pay_max_amount'] + '</span>之间'
                  })
                  return false
                } else if (!bankChecked) {
                  alert({
                    title: '提示',
                    text: '请选择转入银行账户'
                  })
                  return false
                } else return true
              })

              $ports.first().click()

            } else if (type === '网银转账') {

              var $banks = $content.find('#banks')
              var $step1 = $content.find('#step-1')
              var $step2 = $content.find('#step-2')
              var btnNext = $content.find('#next')
              var $form = $content.find('form')
              var data = null

              $step1.show()
              $step2.hide()

              btnNext.on('click', function () {
                var bankChecked = false
                $form.find('input[name=id]').each(function () {
                  if (this.checked) {
                    bankChecked = true
                    return false
                  }
                })

                if (bankChecked) {
                  $step1.hide()
                  $step2.show()
                } else {
                  alert({
                    title: '提示',
                    text: '请选择转入银行账户'
                  })
                }
              })

              $.each(that.data, function (index) {
                $banks.append('<div class="bank-item float-left">' +
                  '<div class="bank-item-row">' +
                  '<span class="bank-item-label">付款银行:</span>' +
                  '<label class="radio radio-default bank-item-radio clear-fix">' +
                  '<input type="radio" name="id" value="' + this.id + '" index="' + index + '"/>' +
                  '<span class="radio-dot float-left"></span>' +
                  '<span class="bank-name float-left">' + this['bank_name'] + '</span>' +
                  '</label>' +
                  '</div>' +
                  '<div class="bank-item-row">' +
                  '<span class="bank-item-label">银行账户:</span>' +
                  '<span class="bank-item-content">' + this['bank_user_name'] + '</span>' +
                  '<span class="bank-item-copy" onclick="">复制</span>' +
                  '</div>' +
                  '<div class="bank-item-row">' +
                  '<span class="bank-item-label">银行卡号:</span>' +
                  '<span class="bank-item-content">' + this['bank_number'] + '</span>' +
                  '<span class="bank-item-copy" onclick="">复制</span>' +
                  '</div>' +
                  '<div class="bank-item-row">' +
                  '<span class="bank-item-label">开户支行:</span>' +
                  '<span class="bank-item-content">' + this['bank_register_branch'] + '</span>' +
                  '<span class="bank-item-copy" onclick="">复制</span>' +
                  '</div></div>')
              })

              var copyBtn = new ClipboardJS('.bank-item-copy', {
                text: function (tag) {
                  return window.$(tag).prev().text()
                }
              })

              copyBtn.on('success', function (e) {
                alert('复制成功')
              })

              copyBtn.on('error', function (e) {
                alert('!!!! 复制失败:\n' + e.action)
              })

              var $username = $form.find('input[name=username]')
              var $amount = $form.find('input[name=amount]')
              var $date = $form.find('input[name=date]')
              var $type = $form.find('select[name=type]')
              var $name = $form.find('input[name=name]')
              var $address = $form.find('input[name=address]')

              var $bankItems = $form.find('input[name=id]')

              $username.val(USER.username)
              $amount.val(USER.queryAmount)

              var now = new Date()

              var month = now.getMonth() + 1
              if (month < 10) month = '0' + month

              var day = now.getMonth() + 1
              if (day < 10) day = '0' + day

              $date.val(now.getFullYear() + '-' + month + '-' + day)

              $bankItems.on('change', function () {
                var index = undefined
                $bankItems.each(function () {
                  if (this.checked) {
                    index = $(this).attr('index')
                    return false
                  }
                })

                if (isNaN(index) || index < 0) {
                  data = null
                } else {
                  data = that.data[index]
                }

                $amount.attr('placeholder', '单笔限额' + data['pay_min'] + '~' + data['pay_max'])
              })

              $form.on('submit', function () {
                var amount = parseInt($amount.val())
                if (!data) {
                  alert({
                    title: '提示',
                    text: '请选择汇款银行',
                    callback: function () {
                      $step2.hide()
                      $step1.show()
                    }
                  })
                  return false
                } else if (!$username.val() || !/^[A-z0-9]{5,20}$/.test($username.val())) {
                  alert({
                    text: '请登录后操作',
                    callback: function () {
                      // window.open('/')
                    }
                  })
                  return false

                } else if (isNaN(amount) || amount < data['pay_min'] || amount > data['pay_max']) {
                  alert({
                    title: '提示',
                    text: '金额必须为<span style="color: #ff0000;">' + data['pay_min']
                      + '</span>到<span style="color: #ff0000;">' + data['pay_max'] + '</span>之间'
                  })

                  return false
                } else if (!$date.val()) {
                  alert({
                    title: '提示',
                    text: '请选择汇款日期'
                  })

                  return false
                } else if (!$type.val()) {
                  alert({
                    title: '提示',
                    text: '请选择汇款方式'
                  })

                  return false
                } else if (!$name.val()) {
                  alert({
                    title: '提示',
                    text: '请输入汇款人姓名'
                  })

                  return false
                } else if (!$address.val()) {
                  alert({
                    title: '提示',
                    text: '请输入汇款地点'
                  })

                  return false
                } else return true
              })

              $('form').hide()
              $form.show()
            }

            tabContent.html($content)
          }
        }
      }
    }

    var tabs = $('.main-tab-item')
    var tabNames = $('.main-tab-item-name')

    // tab点击事件
    tabNames.on('click', function () {
      tabs.removeClass('active')
      var that = $(this)
      that.parent().addClass('active')
      active.setType(that.attr('action'))
    })

    // $.post('api/index.php', {
    //   action: 'getUser'
    // }, function (res) {
    //   res = JSON.parse(res)
    //   if (res.code === 200) {
    //     USER.username = res.data.username
    //   } else {
    //     window.alert({
    //       text: '请登录后操作',
    //       callback: function () {
    //         // window.open('/')
    //       }
    //     })
    //   }
    // })

    $.post('api/index.php', {
      action: 'iniClassList',
      clientType: 'pc'
    }, function (res) {
      $.each(JSON.parse(res), function () {
        $('.main-tab-item[nav=' + this + ']').hide()
      })
    })

    $.post(
      'api/index.php',
      {
        action: 'userRepaymentInfo'
      },
      function (res) {
        res = JSON.parse(res)
        if (res.code === 200) {
          USER.username = res.data['username']
          USER.queryAmount = parseInt(res.data['overdraft'])
          // 初始化选中第一项
          $('.main-tab-item > .main-tab-item-name').first().click()
          $('.main-tab-content').css('display', 'block')
        } else {
          window.alert({
            text: '请登录后操作',
            callback: function () {
              // window.open('/')
            }
          })
        }
      }
    )
  })
</script>
</body>
</html>
